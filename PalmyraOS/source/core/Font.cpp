
#include "core/Font.h"
#include "libs/string.h"


// Static instance of the Arial font
PalmyraOS::fonts::Font PalmyraOS::fonts::FontManager::arial("Arial-12");



///region PalmyraOS::fonts::Glyph
/**
 * Assignment operator for the Glyph structure.
 * Performs a deep copy of the bitmap data.
 * @param other The glyph to copy from.
 * @return Reference to this glyph.
 */
PalmyraOS::fonts::Glyph& PalmyraOS::fonts::Glyph::operator=(const Glyph& other)
{
	// Protect against self-assignment
	if (this == &other) return *this;

	for (size_t i = 0; i < other.width; i++) bitmap[i] = other.bitmap[i];
	width   = other.width;
	height  = other.height;
	offsetX = other.offsetX;
	offsetY = other.offsetY;

	return *this;
}

/**
 * Constructor that initializes a font with a given name.
 * @param name The name of the font.
 */
PalmyraOS::fonts::Font::Font(const char* name)
{
	name_ = name;
}

/**
 * Retrieves a glyph for a given character.
 * @param character The character for which to retrieve the glyph.
 * @return The glyph corresponding to the character.
 */
const PalmyraOS::fonts::Glyph& PalmyraOS::fonts::Font::getGlyph(uint32_t character)
{
	if (character >= MAX_FONT_SIZE) return glyphs_[0];    // Return a default glyph if character is out of range
	return glyphs_[character];
}

///endregion


///region PalmyraOS::fonts::Font

/**
 * Sets a glyph for a given character.
 * @param character The character for which to set the glyph.
 * @param glyph The glyph to set.
 */
void PalmyraOS::fonts::Font::setGlyph(uint32_t character, Glyph glyph)
{
	glyphs_[character] = glyph;
}

///endregion

/**
 * Retrieves a font by its name.
 * @param name The name of the font to retrieve.
 * @return The font corresponding to the name.
 */
PalmyraOS::fonts::Font& PalmyraOS::fonts::FontManager::getFont(const char* name)
{
	if (strcmp(name, "Arial-12") == 0) return arial;
	return arial;
}

/**
 * Initializes the font manager and loads default fonts.
 */
void PalmyraOS::fonts::FontManager::initialize()
{
	for (size_t i = 0; i < 32; i++)
	{
		arial.setGlyph(
			i, {
				{ 0 }, 0, 0, 0, 0
			}
		);
	}

	arial.setGlyph(0x20, {{ 0x00, 0x00, 0x00, 0x00 }, 4, 0, 0, 0 });   // Soace
	arial.setGlyph(0x21, {{ 0x0, 0x1fd, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x21 - !
	arial.setGlyph(0x22, {{ 0x1c0, 0x0, 0x1c0, 0x0 }, 4, 12, 0, 0 }); // Glyph 0x22 - "
	arial.setGlyph(0x23, {{ 0x48, 0x4b, 0x7c, 0x1cb, 0x7c, 0x1c8, 0x48 }, 7, 12, 0, 0 }); // Glyph 0x23 - #
	arial.setGlyph(0x24, {{ 0x0, 0x1cc, 0x222, 0x3ff, 0x222, 0x11c, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x24 - $
	arial.setGlyph(
		0x25,
		{{ 0x0, 0xe0, 0x110, 0x111, 0xe6, 0x38, 0xce, 0x111, 0x11, 0xe, 0x0 }, 11, 12, 0, 0 }
	); // Glyph 0x25 - %
	arial.setGlyph(0x26, {{ 0x0, 0xe, 0xf1, 0x111, 0x129, 0xc6, 0xa, 0x1 }, 8, 12, 0, 0 }); // Glyph 0x26 - &
	arial.setGlyph(0x27, {{ 0x0, 0x1c0 }, 2, 12, 0, 0 }); // Glyph 0x27 - '
	arial.setGlyph(0x28, {{ 0x0, 0xf8, 0x306, 0x401 }, 4, 12, 0, 0 }); // Glyph 0x28 - (
	arial.setGlyph(0x29, {{ 0x401, 0x306, 0xf8, 0x0 }, 4, 12, 0, 0 }); // Glyph 0x29 - )
	arial.setGlyph(0x2a, {{ 0x80, 0xa0, 0x1c0, 0xa0, 0x80 }, 5, 12, 0, 0 }); // Glyph 0x2a - *
	arial.setGlyph(0x2b, {{ 0x0, 0x10, 0x10, 0x7c, 0x10, 0x10, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x2b - +
	arial.setGlyph(0x2c, {{ 0x0, 0x7, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x2c - ,
	arial.setGlyph(0x2d, {{ 0x8, 0x8, 0x8, 0x0 }, 4, 12, 0, 0 }); // Glyph 0x2d - -
	arial.setGlyph(0x2e, {{ 0x0, 0x1, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x2e - .
	arial.setGlyph(0x2f, {{ 0x3, 0x7c, 0x180, 0x0 }, 4, 12, 0, 0 }); // Glyph 0x2f - /
	arial.setGlyph(0x30, {{ 0x0, 0xfe, 0x101, 0x101, 0x101, 0xfe, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x30 - 0
	arial.setGlyph(0x31, {{ 0x0, 0x40, 0x80, 0x1ff, 0x0, 0x0, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x31 - 1
	arial.setGlyph(0x32, {{ 0x0, 0x81, 0x103, 0x105, 0x119, 0xe1, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x32 - 2
	arial.setGlyph(0x33, {{ 0x0, 0x82, 0x101, 0x111, 0x111, 0xee, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x33 - 3
	arial.setGlyph(0x34, {{ 0x0, 0xc, 0x34, 0xc4, 0x1ff, 0x4, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x34 - 4
	arial.setGlyph(0x35, {{ 0x0, 0x72, 0x1a1, 0x121, 0x121, 0x11e, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x35 - 5
	arial.setGlyph(0x36, {{ 0x0, 0xfe, 0x111, 0x121, 0x121, 0x9e, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x36 - 6
	arial.setGlyph(0x37, {{ 0x0, 0x100, 0x107, 0x138, 0x1c0, 0x100, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x37 - 7
	arial.setGlyph(0x38, {{ 0x0, 0xee, 0x111, 0x111, 0x111, 0xee, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x38 - 8
	arial.setGlyph(0x39, {{ 0x0, 0xf2, 0x109, 0x109, 0x111, 0xfe, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x39 - 9
	arial.setGlyph(0x3a, {{ 0x0, 0x41, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x3a - :
	arial.setGlyph(0x3b, {{ 0x0, 0x107, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x3b - ;
	arial.setGlyph(0x3c, {{ 0x0, 0x10, 0x28, 0x28, 0x28, 0x44, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x3c - <
	arial.setGlyph(0x3d, {{ 0x24, 0x24, 0x24, 0x24, 0x24, 0x24, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x3d - =
	arial.setGlyph(0x3e, {{ 0x0, 0x44, 0x28, 0x28, 0x28, 0x10, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x3e - >
	arial.setGlyph(0x3f, {{ 0x0, 0xc0, 0x100, 0x10d, 0x110, 0xe0, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x3f - ?
	arial.setGlyph(
		0x40,
		{{ 0x0, 0xf8, 0x304, 0x472, 0x489, 0x909, 0x909, 0x8f9, 0x989, 0x40a, 0x612, 0x1e4 }, 12, 12, 0, 0 }
	); // Glyph 0x40 - @
	arial.setGlyph(0x41, {{ 0x1c, 0xe8, 0x108, 0xe8, 0x1c, 0x3, 0x0, 0x0, 0x0, 0x0 }, 10, 12, 0, 0 }); // Glyph 0x41 - A
	arial.setGlyph(0x42, {{ 0x0, 0x1ff, 0x111, 0x111, 0x111, 0x111, 0xfe, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x42 - B
	arial.setGlyph(0x43, {{ 0x0, 0x7c, 0x82, 0x101, 0x101, 0x101, 0x82, 0x44, 0x0 }, 9, 12, 0, 0 }); // Glyph 0x43 - C
	arial.setGlyph(0x44, {{ 0x0, 0x1ff, 0x101, 0x101, 0x101, 0x101, 0x82, 0x7c, 0x0 }, 9, 12, 0, 0 }); // Glyph 0x44 - D
	arial.setGlyph(0x45, {{ 0x0, 0x1ff, 0x111, 0x111, 0x111, 0x111, 0x111, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x45 - E
	arial.setGlyph(0x46, {{ 0x0, 0x1ff, 0x110, 0x110, 0x110, 0x100, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x46 - F
	arial.setGlyph(0x47, {{ 0x0, 0x7c, 0x82, 0x101, 0x101, 0x111, 0x92, 0x5c, 0x0 }, 9, 12, 0, 0 }); // Glyph 0x47 - G
	arial.setGlyph(0x48, {{ 0x0, 0x1ff, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1ff, 0x0 }, 9, 12, 0, 0 }); // Glyph 0x48 - H
	arial.setGlyph(0x49, {{ 0x0, 0x1ff, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x49 - I
	arial.setGlyph(0x4a, {{ 0x1, 0x1, 0x1, 0x1fe, 0x0, 0x0 }, 6, 12, 0, 0 }); // Glyph 0x4a - J
	arial.setGlyph(0x4b, {{ 0x0, 0x1ff, 0x8, 0x10, 0x28, 0x44, 0x82, 0x101 }, 8, 12, 0, 0 }); // Glyph 0x4b - K
	arial.setGlyph(0x4c, {{ 0x0, 0x1ff, 0x1, 0x1, 0x1, 0x1, 0x1 }, 7, 12, 0, 0 }); // Glyph 0x4c - L
	arial.setGlyph(
		0x4d,
		{{ 0x0, 0x1ff, 0xc0, 0x3c, 0x3, 0x3c, 0xc0, 0x1ff, 0x0, 0x0 }, 10, 12, 0, 0 }
	); // Glyph 0x4d - M
	arial.setGlyph(0x4e, {{ 0x0, 0x1ff, 0x80, 0x60, 0x10, 0xc, 0x2, 0x1ff, 0x0 }, 9, 12, 0, 0 }); // Glyph 0x4e - N
	arial.setGlyph(0x4f, {{ 0x0, 0x7c, 0x82, 0x101, 0x101, 0x101, 0x82, 0x7c, 0x0 }, 9, 12, 0, 0 }); // Glyph 0x4f - O
	arial.setGlyph(0x50, {{ 0x0, 0x1ff, 0x110, 0x110, 0x110, 0x110, 0xe0, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x50 - P
	arial.setGlyph(0x51, {{ 0x0, 0xf8, 0x104, 0x202, 0x20a, 0x20a, 0x104, 0xfa, 0x0 }, 9, 12, 0, 1 }); // Glyph 0x51 - Q
	arial
		.setGlyph(0x52, {{ 0x0, 0x1ff, 0x110, 0x110, 0x110, 0x118, 0x116, 0xe1, 0x0 }, 9, 12, 0, 0 }); // Glyph 0x52 - R
	arial.setGlyph(0x53, {{ 0x0, 0xe6, 0x111, 0x111, 0x111, 0x111, 0xce, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x53 - S
	arial.setGlyph(0x54, {{ 0x100, 0x100, 0x100, 0x1ff, 0x100, 0x100, 0x100, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x54 - T
	arial.setGlyph(0x55, {{ 0x0, 0x1fc, 0x2, 0x1, 0x1, 0x1, 0x2, 0x1fc, 0x0 }, 9, 12, 0, 0 }); // Glyph 0x55 - U
	arial.setGlyph(0x56, {{ 0x70, 0xc, 0x3, 0xc, 0x70, 0x180, 0x0, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x56 - V
	arial.setGlyph(
		0x57,
		{{ 0x1c0, 0x3c, 0x3, 0x1c, 0xe0, 0x100, 0xe0, 0x1c, 0x3, 0x7c, 0x180, 0x0 }, 12, 12, 0, 0 }
	); // Glyph 0x57 - W
	arial.setGlyph(0x58, {{ 0x101, 0xc6, 0x28, 0x10, 0x28, 0xc6, 0x101, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x58 - X
	arial.setGlyph(0x59, {{ 0x100, 0xc0, 0x20, 0x1f, 0x20, 0xc0, 0x100, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x59 - Y
	arial.setGlyph(0x5a, {{ 0x1, 0x103, 0x10d, 0x111, 0x161, 0x181, 0x101, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x5a - Z
	arial.setGlyph(0x5b, {{ 0x0, 0x7ff, 0x401, 0x0 }, 4, 12, 0, 0 }); // Glyph 0x5b - [
	arial.setGlyph(0x5c, {{ 0x180, 0x7c, 0x3, 0x0 }, 4, 12, 0, 0 }); // Glyph 0x5c - '\'
	arial.setGlyph(0x5d, {{ 0x401, 0x7ff, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x5d - ]
	arial.setGlyph(0x5e, {{ 0x10, 0xe0, 0x100, 0xe0, 0x10, 0x0 }, 6, 12, 0, 0 }); // Glyph 0x5e - ^
	arial.setGlyph(0x5f, {{ 0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x0 }, 8, 12, 0, 0 }); // Glyph 0x5f - _
	arial.setGlyph(0x60, {{ 0x0, 0x100, 0x80, 0x0 }, 4, 12, 0, 0 }); // Glyph 0x60 - `
	arial.setGlyph(0x61, {{ 0x0, 0x26, 0x49, 0x49, 0x4a, 0x3f, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x61 - a
	arial.setGlyph(0x62, {{ 0x0, 0x1ff, 0x22, 0x41, 0x41, 0x3e, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x62 - b
	arial.setGlyph(0x63, {{ 0x0, 0x3e, 0x41, 0x41, 0x22, 0x0 }, 6, 12, 0, 0 }); // Glyph 0x63 - c
	arial.setGlyph(0x64, {{ 0x0, 0x3e, 0x41, 0x41, 0x22, 0x1ff, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x64 - d
	arial.setGlyph(0x65, {{ 0x0, 0x3e, 0x49, 0x49, 0x49, 0x3a, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x65 - e
	arial.setGlyph(0x66, {{ 0x40, 0xff, 0x140, 0x100 }, 4, 12, 0, 0 }); // Glyph 0x66 - f
	arial.setGlyph(0x67, {{ 0x0, 0xf9, 0x105, 0x105, 0x89, 0x1fe, 0x0 }, 7, 12, 0, 2 }); // Glyph 0x67 - g
	arial.setGlyph(0x68, {{ 0x0, 0x1ff, 0x20, 0x40, 0x40, 0x3f, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x68 - h
	arial.setGlyph(0x69, {{ 0x0, 0x17f, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x69 - i
	arial.setGlyph(0x6a, {{ 0x1, 0x5fe, 0x0, 0x0 }, 4, 12, 0, 4 }); // Glyph 0x6a - j
	arial.setGlyph(0x6b, {{ 0x0, 0x1ff, 0x8, 0x18, 0x26, 0x41 }, 6, 12, 0, 0 }); // Glyph 0x6b - k
	arial.setGlyph(0x6c, {{ 0x0, 0x1ff, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x6c - l
	arial.setGlyph(
		0x6d,
		{{ 0x0, 0x7f, 0x20, 0x40, 0x40, 0x3f, 0x20, 0x40, 0x40, 0x3f }, 10, 12, 0, 0 }
	); // Glyph 0x6d - m
	arial.setGlyph(0x6e, {{ 0x0, 0x7f, 0x20, 0x40, 0x40, 0x3f, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x6e - n
	arial.setGlyph(0x6f, {{ 0x0, 0x3e, 0x41, 0x41, 0x41, 0x3e, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x6f - o
	arial.setGlyph(0x70, {{ 0x0, 0x1ff, 0x88, 0x104, 0x104, 0xf8, 0x0 }, 7, 12, 0, 2 }); // Glyph 0x70 - p
	arial.setGlyph(0x71, {{ 0x0, 0xf8, 0x104, 0x104, 0x88, 0x1ff, 0x0 }, 7, 12, 0, 2 }); // Glyph 0x71 - q
	arial.setGlyph(0x72, {{ 0x0, 0x7f, 0x20, 0x40, 0x0 }, 5, 12, 0, 0 }); // Glyph 0x72 - r
	arial.setGlyph(0x73, {{ 0x0, 0x32, 0x49, 0x49, 0x49, 0x26 }, 6, 12, 0, 0 }); // Glyph 0x73 - s
	arial.setGlyph(0x74, {{ 0x80, 0x3fe, 0x82, 0x0 }, 4, 12, 0, 1 }); // Glyph 0x74 - t
	arial.setGlyph(0x75, {{ 0x0, 0x7e, 0x1, 0x1, 0x1, 0x7f, 0x0 }, 7, 12, 0, 0 }); // Glyph 0x75 - u
	arial.setGlyph(0x76, {{ 0x60, 0x1c, 0x3, 0x1c, 0x60, 0x0 }, 6, 12, 0, 0 }); // Glyph 0x76 - v
	arial.setGlyph(0x77, {{ 0x60, 0x1c, 0x3, 0x1c, 0x60, 0x1c, 0x3, 0x1c, 0x60 }, 9, 12, 0, 0 }); // Glyph 0x77 - w
	arial.setGlyph(0x78, {{ 0x41, 0x36, 0x8, 0x36, 0x41, 0x0 }, 6, 12, 0, 0 }); // Glyph 0x78 - x
	arial.setGlyph(0x79, {{ 0x180, 0x71, 0xe, 0x70, 0x180 }, 5, 12, 0, 2 }); // Glyph 0x79 - y
	arial.setGlyph(0x7a, {{ 0x41, 0x47, 0x49, 0x71, 0x41, 0x0 }, 6, 12, 0, 0 }); // Glyph 0x7a - z
	arial.setGlyph(0x7b, {{ 0x20, 0x3de, 0x401, 0x0 }, 4, 12, 0, 0 }); // Glyph 0x7b - {
	arial.setGlyph(0x7c, {{ 0x0, 0x7ff, 0x0 }, 3, 12, 0, 0 }); // Glyph 0x7c - |
	arial.setGlyph(0x7d, {{ 0x0, 0x401, 0x3de, 0x20 }, 4, 12, 0, 0 }); // Glyph 0x7d - }
	arial.setGlyph(0x7e, {{ 0x0, 0x8, 0x10, 0x10, 0x8, 0x8, 0x10 }, 7, 12, 0, 0 }); // Glyph 0x7e - ~

}